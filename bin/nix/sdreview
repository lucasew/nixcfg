#!/usr/bin/env bash

# run nixpkgs-review for a PR in a systemd unit

PR="$1"; shift

systemd-run \
  --user \
  --working-directory ~/nixpkgs \
  -P \
  --unit "nixpkgs-review-$PR" \
  --collect \
  -p KillSignal=SIGINT \
  -p TimeoutStopSec=infinity \
  -E POST_REVIEW_SLEEP=120 \
  \
  sdw nix review --really \
  \
  pr \
  "$PR" "$@" \
  --no-shell \
  --post-result \
  --build-graph nix
