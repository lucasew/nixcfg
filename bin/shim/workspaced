#!/usr/bin/env bash
# Automatically generated workspaced shim

# Find dotfiles root using the same logic as sd
if [[ -d "$HOME/.dotfiles" ]]; then
	DOTFILES_ROOT="$HOME/.dotfiles"
elif [[ -d "/etc/.dotfiles" ]]; then
	DOTFILES_ROOT="/etc/.dotfiles"
else
	# Try to use sd to find it if available
	DOTFILES_ROOT=$(sd d root 2>/dev/null)
fi

SOURCE_DIR="$DOTFILES_ROOT/nix/pkgs/workspaced"

mkdir -p ~/.local/share/workspaced/bin
(
	cd "$SOURCE_DIR" || exit 1
	mise exec go@1.23.6 -- env CGO_ENABLED=0 go build -v -o ~/.local/share/workspaced/bin/workspaced ./cmd/workspaced
)

exec ~/.local/share/workspaced/bin/workspaced "$@"
