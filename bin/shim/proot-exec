#!/usr/bin/env bash
# proot-exec: Execute commands in Termux with proot to avoid syscall restrictions
# Usage: proot-exec <command> [args...]

if [ -n "${TERMUX_VERSION:-}" ]; then
	# On Termux, use proot directly to avoid termux-chroot's broken sh -c wrapper
	PREFIX=/data/data/com.termux/files

	# Use proot with minimal required bindings
	env -u LD_PRELOAD "$PREFIX/usr/bin/proot" \
		--kill-on-exit \
		-w "$(pwd)" \
		-b /system:/system \
		-b /data:/data \
		-b "$PREFIX/usr:/usr" \
		-b "$PREFIX/usr/bin:/bin" \
		-b "$PREFIX/usr/etc:/etc" \
		-b "$PREFIX/usr/lib:/lib" \
		-b "$PREFIX/home:/home" \
		-r "$PREFIX/.." \
		"$@"
else
	# Not on Termux, execute directly
	exec "$@"
fi
