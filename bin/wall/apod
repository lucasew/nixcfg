#!/usr/bin/env bash
# fetch one image from NASA and apply as wallpaper
set -eu

CACHE_DIR="${XDG_CACHE_HOME:-$HOME/.cache}/wall"
mkdir -p "$CACHE_DIR"
OUT_FILE="$CACHE_DIR/apod.jpg"

if [[ -z "${NASA_API_KEY:-}" ]]; then
    echo "⚠️  Warning: NASA_API_KEY not set. Using 'DEMO_KEY'." >&2
    echo "   Please set NASA_API_KEY in your environment to avoid rate limits." >&2
    NASA_API_KEY="DEMO_KEY"
fi

curl "$(curl -L "https://api.nasa.gov/planetary/apod?api_key=$NASA_API_KEY&count=1" | jq .[0].hdurl -r)" --output "$OUT_FILE"
sd wall change "$OUT_FILE"
