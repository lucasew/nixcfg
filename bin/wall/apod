#!/usr/bin/env bash
# fetch one image from NASA and apply as wallpaper
set -eu

CACHE_DIR="${XDG_CACHE_HOME:-$HOME/.cache}/wall"
mkdir -p "$CACHE_DIR"
OUT_FILE="$CACHE_DIR/apod.jpg"

if [[ -z "${NASA_API_KEY:-}" ]]; then
    echo "ðŸš¨ Error: NASA_API_KEY is not set." >&2
    echo "   Please obtain an API key from https://api.nasa.gov/ and set it as an environment variable." >&2
    exit 1
fi

curl "$(curl -L "https://api.nasa.gov/planetary/apod?api_key=$NASA_API_KEY&count=1" | jq .[0].hdurl -r)" --output "$OUT_FILE"
sd wall change "$OUT_FILE"
