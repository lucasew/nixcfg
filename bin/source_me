#!/usr/bin/env bash

# basically starts the modular bashrc
export SD_ROOT
SD_ROOT="$(dirname "$(realpath "$BASH_SOURCE")")"

if [[ "$SD_ROOT" =~ "/nix" ]]; then
	if [[ -d ~/.dotfiles/bin ]]; then
		SD_ROOT=~/.dotfiles/bin
	elif [[ -d /etc/.dotfiles/bin ]]; then
		SD_ROOT=/etc/.dotfiles/bin
	fi
fi

# Use workspaced shell init if available (faster parallel loading + caching)
if command -v workspaced >/dev/null 2>&1; then
	eval "$(workspaced dispatch shell init bash)"
else
	# Fallback to sequential loading
	for script in "$SD_ROOT/prelude/"*; do
		. "$script"
	done
fi

(return 0 2>/dev/null) || "$@"
